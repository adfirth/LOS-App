<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LOS App - Testing with Mock Firebase</title>
    <link rel="stylesheet" href="assets/style.css">
    <style>
        .test-banner {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            color: white;
            padding: 10px;
            text-align: center;
            font-weight: bold;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 9999;
        }
        .test-info {
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            margin: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-controls {
            background: #f8f9fa;
            padding: 15px;
            margin: 20px;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        .test-controls button {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .test-controls button:hover {
            background: #0056b3;
        }
        .test-controls button.success {
            background: #28a745;
        }
        .test-controls button.warning {
            background: #ffc107;
            color: #212529;
        }
        .status-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 20px;
        }
        .status-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        .status-card h4 {
            margin-top: 0;
            color: #495057;
        }
        .status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 0;
            border-bottom: 1px solid #e9ecef;
        }
        .status-item:last-child {
            border-bottom: none;
        }
        .status-value {
            font-weight: bold;
        }
        .status-success { color: #28a745; }
        .status-warning { color: #ffc107; }
        .status-error { color: #dc3545; }
        .firebase-toggle {
            background: #6f42c1;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 10px 0;
            font-weight: bold;
        }
        .firebase-toggle:hover {
            background: #5a32a3;
        }
        .firebase-toggle.active {
            background: #28a745;
        }
    </style>
</head>
<body>
    <div class="test-banner">
        üß™ TESTING WITH MOCK FIREBASE - No Build Required
    </div>
    
    <div class="test-info">
        <h3>üöÄ Enhanced Testing with Mock Firebase</h3>
        <p>This testing page can use mock Firebase objects to test your app without real Firebase dependencies.</p>
        <p><strong>Status:</strong> <span id="load-status">Initializing...</span></p>
        
        <button id="firebase-toggle" class="firebase-toggle" onclick="toggleFirebase()">
            üî• Enable Mock Firebase
        </button>
        <p id="firebase-status-text">Mock Firebase is disabled. Click the button above to enable it for testing.</p>
    </div>

    <div class="status-grid">
        <div class="status-card">
            <h4>üìÅ File Loading Status</h4>
            <div class="status-item">
                <span>Main App:</span>
                <span id="app-status" class="status-value">‚è≥ Loading...</span>
            </div>
            <div class="status-item">
                <span>Modules:</span>
                <span id="modules-status" class="status-value">‚è≥ Loading...</span>
            </div>
            <div class="status-item">
                <span>CSS:</span>
                <span id="css-status" class="status-value">‚è≥ Loading...</span>
            </div>
        </div>
        
        <div class="status-card">
            <h4>üîß App Status</h4>
            <div class="status-item">
                <span>App Object:</span>
                <span id="app-object-status" class="status-value">‚è≥ Checking...</span>
            </div>
            <div class="status-item">
                <span>Firebase:</span>
                <span id="firebase-status" class="status-value">‚è≥ Checking...</span>
            </div>
            <div class="status-item">
                <span>Initialized:</span>
                <span id="init-status" class="status-value">‚è≥ Checking...</span>
            </div>
        </div>
    </div>

    <div class="test-controls">
        <h4>üß™ Testing Controls</h4>
        <button onclick="testApp()">Test App Functionality</button>
        <button onclick="checkModules()">Check Module Loading</button>
        <button onclick="checkFirebase()">Check Firebase Status</button>
        <button onclick="testMockFirebase()">Test Mock Firebase</button>
        <button onclick="clearConsole()">Clear Console</button>
        <button onclick="window.location.reload()">üîÑ Refresh Page</button>
    </div>

    <div id="error-log" class="error-log"></div>

    <!-- Load mock Firebase first (optional) -->
    <script src="test-mock-firebase.js"></script>
    
    <!-- Load source files directly -->
    <script type="module">
        console.log('üß™ Starting enhanced testing with mock Firebase support...');
        
        let mockFirebaseEnabled = false;
        let appLoaded = false;
        
        // Status update functions
        function updateStatus(elementId, status, type = 'success') {
            const element = document.getElementById(elementId);
            if (element) {
                element.textContent = status;
                element.className = `status-value status-${type}`;
            }
        }
        
        function updateLoadStatus(message, isError = false) {
            const loadStatus = document.getElementById('load-status');
            if (loadStatus) {
                loadStatus.textContent = message;
                loadStatus.style.color = isError ? '#dc3545' : '#28a745';
            }
        }
        
        function logError(message) {
            const errorLog = document.getElementById('error-log');
            if (errorLog) {
                errorLog.style.display = 'block';
                errorLog.innerHTML += `<div>‚ùå ${message}</div>`;
            }
            console.error('‚ùå', message);
        }
        
        // Check CSS loading
        function checkCSSLoading() {
            const link = document.querySelector('link[href="assets/style.css"]');
            if (link && link.sheet) {
                updateStatus('css-status', '‚úÖ Loaded', 'success');
            } else {
                updateStatus('css-status', '‚ùå Failed', 'error');
                logError('CSS file failed to load');
            }
        }
        
        // Check Firebase status
        function checkFirebaseStatus() {
            if (window.db && window.auth) {
                const isMock = window.db.collection && typeof window.db.collection === 'function';
                const status = isMock ? '‚úÖ Mock Available' : '‚úÖ Real Available';
                updateStatus('firebase-status', status, 'success');
                return true;
            } else {
                updateStatus('firebase-status', '‚ùå Not Found', 'error');
                return false;
            }
        }
        
        // Check app object status
        function checkAppObjectStatus() {
            if (window.app) {
                updateStatus('app-object-status', '‚úÖ Found', 'success');
                updateStatus('init-status', window.app.initialized ? '‚úÖ Yes' : '‚ùå No', window.app.initialized ? 'success' : 'warning');
                return true;
            } else {
                updateStatus('app-object-status', '‚ùå Not Found', 'error');
                updateStatus('init-status', '‚ùå N/A', 'error');
                return false;
            }
        }
        
        // Try to load the main app
        async function loadApp() {
            try {
                updateStatus('app-status', '‚è≥ Loading...', 'warning');
                updateLoadStatus('Loading main app module...');
                
                // Import the main app
                const appModule = await import('./src/app.js');
                console.log('‚úÖ Main app module loaded successfully');
                updateStatus('app-status', '‚úÖ Loaded', 'success');
                appLoaded = true;
                
                // Check if app was initialized
                setTimeout(() => {
                    checkFirebaseStatus();
                    checkAppObjectStatus();
                    
                    if (checkAppObjectStatus()) {
                        updateLoadStatus('‚úÖ App loaded and ready for testing!');
                    } else {
                        updateLoadStatus('‚ö†Ô∏è App loaded but not fully initialized');
                    }
                }, 1000);
                
            } catch (error) {
                updateStatus('app-status', '‚ùå Failed', 'error');
                updateLoadStatus(`Failed to load main app: ${error.message}`, true);
                logError(`Failed to load main app: ${error.message}`);
                console.error('‚ùå Failed to load main app:', error);
            }
        }
        
        // Check modules directory
        async function checkModulesStatus() {
            try {
                updateStatus('modules-status', '‚è≥ Checking...', 'warning');
                
                // Try to fetch modules directory
                const response = await fetch('./src/modules/');
                if (response.ok) {
                    updateStatus('modules-status', '‚úÖ Accessible', 'success');
                } else {
                    updateStatus('modules-status', '‚ö†Ô∏è Limited Access', 'warning');
                }
            } catch (error) {
                updateStatus('modules-status', '‚ö†Ô∏è File Protocol', 'warning');
                console.log('‚ÑπÔ∏è Cannot fetch modules directory (this is normal for file:// protocol)');
            }
        }
        
        // Test mock Firebase functionality
        window.testMockFirebase = function() {
            console.log('üß™ Testing mock Firebase functionality...');
            
            if (!window.db || !window.auth) {
                console.log('‚ùå Mock Firebase not available');
                return;
            }
            
            try {
                // Test database operations
                console.log('üìä Testing mock database...');
                const testCollection = window.db.collection('test');
                const testDoc = testCollection.doc('test-id');
                
                // Test get operation
                testDoc.get().then(result => {
                    console.log('‚úÖ Mock doc.get() works:', result);
                });
                
                // Test auth operations
                console.log('üîê Testing mock auth...');
                window.auth.signInWithEmailAndPassword('test@test.com', 'password').then(result => {
                    console.log('‚úÖ Mock signIn works:', result);
                });
                
                console.log('‚úÖ Mock Firebase tests completed');
                
            } catch (error) {
                console.error('‚ùå Mock Firebase test failed:', error);
            }
        };
        
        // Initialize testing
        async function initializeTesting() {
            console.log('üß™ Initializing enhanced testing environment...');
            
            // Check CSS loading
            setTimeout(checkCSSLoading, 100);
            
            // Check modules status
            await checkModulesStatus();
            
            // Load the app
            await loadApp();
            
            // Set up periodic checks
            setInterval(() => {
                checkFirebaseStatus();
                checkAppObjectStatus();
            }, 2000);
        }
        
        // Test functions
        window.testApp = function() {
            console.log('üß™ Testing app functionality...');
            try {
                if (checkAppObjectStatus()) {
                    console.log('‚úÖ App object found:', window.app);
                    console.log('üîß App state:', window.app.state);
                    console.log('üìä Managers loaded:', {
                        auth: !!window.app.authManager,
                        registration: !!window.app.registrationManager,
                        fixtures: !!window.app.fixturesManager,
                        scores: !!window.app.scoresManager,
                        ui: !!window.app.uiManager
                    });
                } else {
                    console.log('‚ÑπÔ∏è App object not found, checking for other global objects...');
                    const globalObjects = Object.keys(window).filter(key => 
                        !key.startsWith('_') && 
                        !key.startsWith('webkit') && 
                        !key.startsWith('moz') &&
                        typeof window[key] === 'object' &&
                        window[key] !== null
                    );
                    console.log('üåê Global objects:', globalObjects.slice(0, 20));
                }
            } catch (error) {
                console.error('‚ùå Error testing app:', error);
            }
        };
        
        window.checkModules = function() {
            console.log('üîç Checking module loading...');
            checkModulesStatus();
        };
        
        window.checkFirebase = function() {
            console.log('üî• Checking Firebase status...');
            checkFirebaseStatus();
        };
        
        window.clearConsole = function() {
            console.clear();
            const errorLog = document.getElementById('error-log');
            if (errorLog) {
                errorLog.innerHTML = '';
                errorLog.style.display = 'none';
            }
            console.log('üßπ Console cleared');
        };
        
        // Start testing
        initializeTesting();
        
    </script>
    
    <script>
        // Firebase toggle functionality
        function toggleFirebase() {
            const toggleBtn = document.getElementById('firebase-toggle');
            const statusText = document.getElementById('firebase-status-text');
            
            if (!mockFirebaseEnabled) {
                // Enable mock Firebase
                mockFirebaseEnabled = true;
                toggleBtn.textContent = '‚úÖ Mock Firebase Enabled';
                toggleBtn.className = 'firebase-toggle active';
                statusText.textContent = 'Mock Firebase is now enabled. Your app can use mock database and auth objects for testing.';
                
                // Force Firebase status check
                if (window.checkFirebase) {
                    window.checkFirebase();
                }
                
                console.log('üî• Mock Firebase enabled for testing');
            } else {
                // Disable mock Firebase
                mockFirebaseEnabled = false;
                toggleBtn.textContent = 'üî• Enable Mock Firebase';
                toggleBtn.className = 'firebase-toggle';
                statusText.textContent = 'Mock Firebase is disabled. Click the button above to enable it for testing.';
                
                console.log('üî• Mock Firebase disabled');
            }
        }
        
        // Additional testing utilities
        console.log('üß™ Enhanced testing environment initialized');
        console.log('üí° Use the test controls above to test functionality');
        console.log('üîç Check the console for detailed loading information');
        console.log('üî• Mock Firebase is available for testing');
    </script>
</body>
</html>
